observability {

  # Application metadata
  app {
    name = "data-observability-platform"
    version = "0.1.0"
  }

  # Spark configuration
  spark {
    master = "local[*]"
    master = ${?SPARK_MASTER}  # Override with env var
    app-name = "Observability-Listener"

    # Iceberg catalog configuration
    catalog {
      type = "hadoop"
      warehouse = "data/metadata/iceberg-warehouse"
      warehouse = ${?ICEBERG_WAREHOUSE}
    }
  }

  # PostgreSQL configuration for lineage graph
  postgres {
    host = "localhost"
    host = ${?POSTGRES_HOST}
    port = 5432
    port = ${?POSTGRES_PORT}
    database = "lineage_db"
    database = ${?POSTGRES_DB}
    user = "observability"
    user = ${?POSTGRES_USER}
    password = "observability123"
    password = ${?POSTGRES_PASSWORD}

    # Connection pool
    pool {
      max-connections = 10
      min-connections = 2
    }
  }

  # MinIO/S3 configuration
  minio {
    endpoint = "http://localhost:9000"
    endpoint = ${?MINIO_ENDPOINT}
    access-key = "minioadmin"
    access-key = ${?MINIO_ACCESS_KEY}
    secret-key = "minioadmin123"
    secret-key = ${?MINIO_SECRET_KEY}
    bucket = "observability-metadata"
  }

  # Metadata capture settings
  metadata {
    # Enable/disable specific metadata collection
    capture {
      lineage = true
      schema = true
      row-counts = true
      execution-metrics = true
      data-quality = true
    }

    # Batch size for metadata writes
    batch-size = 100

    # Flush interval (milliseconds)
    flush-interval = 5000
  }

  # Anomaly detection configuration
  anomaly-detection {
    enabled = true

    # Statistical thresholds
    row-count {
      enabled = true
      # Number of standard deviations for anomaly threshold
      stddev-threshold = 3.0
      # Historical window for calculating mean/stddev (days)
      lookback-days = 30
    }

    schema-changes {
      enabled = true
      # Alert on these types of changes
      alert-on-new-column = true
      alert-on-dropped-column = true
      alert-on-type-change = true
      alert-on-column-reorder = false
    }

    # Freshness monitoring
    freshness {
      enabled = true
      # Default SLA in hours (can be overridden per table)
      default-sla-hours = 24
    }
  }

  # Alerting configuration
  alerts {
    # Channels
    slack {
      enabled = false
      webhook-url = ${?SLACK_WEBHOOK_URL}
    }

    email {
      enabled = false
      smtp-host = ${?SMTP_HOST}
      smtp-port = ${?SMTP_PORT}
      from-address = ${?EMAIL_FROM}
      to-addresses = ${?EMAIL_TO}
    }

    # Console logging (always enabled for development)
    console {
      enabled = true
    }
  }

  # API server configuration
  api {
    host = "0.0.0.0"
    port = 8000
    port = ${?API_PORT}
  }
}